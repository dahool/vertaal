{% load i18n errors %}
<script type="text/javascript" src="{{STATIC_URL}}js/simpletooltip2.js"></script>
<script type="text/javascript" src="{{STATIC_URL}}js/errors.js"></script>
<link media="screen" href="{{STATIC_URL}}css/widgets/simpletooltip2.css" type="text/css" rel="stylesheet" />

<script type="text/javascript">
$(function() {
    $("a.file-reload").on('click', function(ev) {
        ev.preventDefault();
        $("#upload_form").attr('action',$(this).attr('alt'));
        $("#file_name").html(interpolate(gettext('Replacing %s'), [$(this).attr('alt2')]));
        $("#new_upload").dialog('open');
    });
    $("#upload_form").on('submit', function(ev) {
        $("#new_upload").dialog('close');
    });

    $("#new_upload").dialog({
        autoOpen: false,
        width: 350,
        modal: true,
        resizable: false,
        open: function() {
            $("#id_comment").val('');
        },
        close: function() {
            $("#id_comment").removeClass( "ui-state-error" );
        }
    });
    
	{% if form.errors %}
    $("#upload_form").attr('action','{% url submit_new_file uploadfile.slug %}');
    $("#file_name").html(interpolate(gettext('Replacing %s'), ['{{uploadfile.filename}}']));
	$("#new_upload").dialog('open');
    {% endif %}
});
</script>

<div id="new_upload" >
    <form id="upload_form" class="form-style" method="post" enctype="multipart/form-data" accept-charset="utf-8">
        {% csrf_token %}
        <div class="icon upload" id="file_name"></div>
        <div class="upload-control">
            <table>
                <tr>
                    <td><input type="file" id="id_file" name="file"/></td>
                    <td><input type="submit" onclick="popoverlay('{% trans "Please wait, this could take some time..." %}')" class="icon upload-go" value="{% trans "Upload" %}"/></td>
                </tr>
                <tr>
                    <td colspan="2">
                        <span class="help_text">{% trans "Comments" %}:&nbsp;<em>*</em></span>
                        {% if form.comment.errors %}<span class="error">{% endif %}
                        <input id="id_comment" name="comment" maxlength="255" type="text">
                        {% if form.comment.errors %}
                        </span>
                        {% endif %}
                    </td>
                </tr>
            </table>
            {% if form.file.errors %}
            {{form.file.errors}}
            {% endif %}
        </div>
    </form> 
</div> 
